{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Electricity Generated",
    "params": 
    [
      {
        "name": "Year_selection",
        "value": 2018,
        "bind": 
        {
          "input": "range",
          "min": 2000,
          "max": 2020,
          "step": 1,
          "name": "Year: "
        }
      }
    ],
    "vconcat":
    [
        {
            "width": "container",
            "height": 500,
            "projection": {"type": "equalEarth"},
            "layer": 
            [
                {
                    "data": 
                    {
                        "url": "https://raw.githubusercontent.com/wchaGit/FIT3179_Visualisation2/master/js/ne_110m.topojson",
                        "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
                    },
                    "mark": 
                    {
                        "type": "geoshape",
                        "fill": "#ddd",
                        "stroke": "white",
                        "strokeWidth": 1
                    }
                },
                {
                    "data":
                    {
                        "url": "https://raw.githubusercontent.com/wchaGit/FIT3179_Visualisation2/master/data/total_generation.csv"
                    },
                    "params":
                    [
                        {
                            "name": "loc_select",
                            "select": {"type": "point", "encodings": ["description"]}
                        }
                    ],
                    "transform":
                    [
                        {
                            "lookup": "Area",
                            "from":
                            {
                                "data":
                                {
                                    "url": "https://raw.githubusercontent.com/wchaGit/FIT3179_Visualisation2/master/js/ne_110m.topojson",
                                    "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
                                },
                                "key": "properties.NAME"
                            },
                            "as": "geo"
                        },
                        {"filter": "datum.Year == Year_selection"}
                    ],
                    "mark": {"type": "geoshape", "stroke": "#fff", "strokeWidth": 0.5},
                    "encoding":
                    {
                      "shape": {"field": "geo", "type": "geojson"},
                      "color":
                      {
                        "field": "Value",
                        "type": "quantitative",
                        "title": "Generated",
                        "scale": {"type": "linear"},
                        "legend": {"format": ".2s"}
                      },
                      "tooltip":
                      [
                        {"field": "Area", "type": "nominal", "title": "Country"},
                        {"field": "Value", "type": "quantitative", "title": "Generated"}
                      ]
                    }
                }
            ]
        },
        {
            "width": "container",
            "height": 300,
            "layer": 
            [
                {
                    "mark": "line",
                    "transform":
                    [
                        {"filter": {"param": "loc_select"}}
                    ],
                    "encoding":
                    {
                        "x": {"field": "Year", "type": "temporal", "axis": {"grid": false}, "title": "Year"},
                        "y": {"field": "Value", "type": "quantitative", "title": "Electricity generated", "axis": {"format": ".2s"}}
                    }
                },
                {
                    "mark":
                    {
                        "type": "text",
                        "align": "right",
                        "baseline": "bottom",
                        "x": "width",
                        "y": 0
                    },
                    "encoding":
                    {
                        "text": 
                        {
                            "condition":
                            {
                                "test": "!isDefined(loc_select.Area)",
                                "value": ""
                            },
                            "value": {"expr": "loc_select.Area"}
                        }
                    }
                }
            ]
        }
    ]
}